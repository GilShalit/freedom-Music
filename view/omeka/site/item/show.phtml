<?php
$translate = $this->plugin('translate');
$escape = $this->plugin('escapeHtml');

$this->headLink()->appendStylesheet($this->assetUrl('css/resource-page-blocks.css', 'Omeka'));
$this->htmlElement('body')->appendAttribute('class', 'item resource show');

$filterLocale = (bool) $this->siteSetting('filter_locale_values');
$lang = $this->lang();
$valueLang = $filterLocale ? [$lang, ''] : null;

// Regions
$mainBlockContent = $this->resourcePageBlocks($item);
$mainHasBlocks = $mainBlockContent->hasBlocks();

$leftSidebarBlockContent = $this->resourcePageBlocks($item, 'left');
$leftSidebarHasBlocks = $leftSidebarBlockContent->hasBlocks();
$rightSidebarBlockContent = $this->resourcePageBlocks($item, 'right');
$rightSidebarHasBlocks = $rightSidebarBlockContent->hasBlocks();
?>

<?php echo $this->ResourceTags($item); ?>
<?php
    $lLang = $lang;
    //the english resource is saved with 'en' but the page language is 'en-US'
    if ($lLang === "en-US") {$lLang = "en";} 
    echo $this->pageTitle($item->displayTitle(null, $lLang), 1); 
?>

<?php $this->trigger('view.show.before'); ?>

<?php if ($mainHasBlocks || $leftSidebarHasBlocks || $rightSidebarHasBlocks): ?>

    <?php
    $additionalContainerClasses = '';
    if ($mainHasBlocks && $leftSidebarHasBlocks && $rightSidebarHasBlocks) {
        $additionalContainerClasses = 'regions-container--all';
    } elseif ($mainHasBlocks && !$leftSidebarHasBlocks && !$rightSidebarHasBlocks) {
        $additionalContainerClasses = 'regions-container--main';
    }
    ?>

    <div class="regions-container <?php echo $additionalContainerClasses; ?>">
        <?php if ($leftSidebarHasBlocks && $blockContent = $leftSidebarBlockContent->getBlocks()): ?>
            <div class="sidebar-region sidebar-region--left">
                <div class="metadata">
                    <?php echo $blockContent; ?>
                </div>
            </div>
        <?php endif; ?>

        <?php if ($mainHasBlocks && $blockContent = $mainBlockContent->getBlocks()): ?>
            <div class="main-region">
                <div class="metadata">
                    <?php echo $blockContent; ?>
                </div>
            </div>
        <?php endif; ?>

        <?php if ($rightSidebarHasBlocks && $blockContent = $rightSidebarBlockContent->getBlocks()): ?>
            <div class="sidebar-region sidebar-region--right">
                <div class="metadata">
                    <?php echo $blockContent; ?>
                </div>
            </div>
        <?php endif; ?>
    </div>

<?php endif; ?>

<?php $this->trigger('view.show.after'); ?>
